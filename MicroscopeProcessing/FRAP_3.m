
num=12;
%% 
% results = cell(1,10);
% results{1} = load('/Volumes/houghgrp/Processed Images/2019-1-18_1/results.mat');
% results{2} = load('/Volumes/houghgrp/Processed Images/2019-1-18_3/results.mat');
% results{3} = load('/Volumes/houghgrp/Processed Images/2019-1-18_19/results.mat');
% results{4} = load('/Volumes/houghgrp/Processed Images/2019-1-18_17/results.mat');
% results{5} = load('/Volumes/houghgrp/Processed Images/2019-1-18_7/results.mat');
% results{6} = load('/Volumes/houghgrp/Processed Images/2019-1-18_5/results.mat');
% results{7} = load('/Volumes/houghgrp/Processed Images/2019-1-18_11/results.mat');
% results{8} = load('/Volumes/houghgrp/Processed Images/2019-1-18_9/results.mat');
% results{9} = load('/Volumes/houghgrp/Processed Images/2019-1-18_15/results.mat');
% results{10} = load('/Volumes/houghgrp/Processed Images/2019-1-18_13/results.mat');
%%
% results = cell(1,num);
% results{1} = load('/Volumes/houghgrp/Processed Images/2019-1-25_1/results.mat');
% results{2} = load('/Volumes/houghgrp/Processed Images/2019-1-25_3/results.mat');
% results{3} = load('/Volumes/houghgrp/Processed Images/2019-1-25_5/results.mat');
% results{4} = load('/Volumes/houghgrp/Processed Images/2019-1-25_7/results.mat');

%%
%  results = cell(1,num);
% results{1} = load('/Volumes/houghgrp/Processed Images/2019-1-30_1/results.mat');
% disp('1')
% results{2} = load('/Volumes/houghgrp/Processed Images/2019-1-30_3/results.mat');
% results{3} = load('/Volumes/houghgrp/Processed Images/2019-1-30_5/results.mat');
% disp('3')
% results{4} = load('/Volumes/houghgrp/Processed Images/2019-1-30_7/results.mat');
% results{5} = load('/Volumes/houghgrp/Processed Images/2019-1-30_9/results.mat');
% disp('5')
% results{6} = load('/Volumes/houghgrp/Processed Images/2019-1-30_11/results.mat');
% results{7} = load('/Volumes/houghgrp/Processed Images/2019-1-30_13/results.mat');
% disp('7')
% results{8} = load('/Volumes/houghgrp/Processed Images/2019-1-30_15/results.mat');
% results{9} = load('/Volumes/houghgrp/Processed Images/2019-1-30_17/results.mat');
% disp('9')
% results{10} = load('/Volumes/houghgrp/Processed Images/2019-1-30_19/results.mat');
% results{11} = load('/Volumes/houghgrp/Processed Images/2019-1-30_21/results.mat');
% disp('11')
% results{12} = load('/Volumes/houghgrp/Processed Images/2019-1-30_23/results.mat');

%%
a.results = cell(1,12);
a.results{1} = load('/Volumes/houghgrp/Processed Images/2019-2-6_1/results.mat');
disp('1')
a.results{2} = load('/Volumes/houghgrp/Processed Images/2019-2-6_3/results.mat');
a.results{3} = load('/Volumes/houghgrp/Processed Images/2019-2-6_5/results.mat');
disp('3')
a.results{4} = load('/Volumes/houghgrp/Processed Images/2019-2-6_7/results.mat');
a.results{5} = load('/Volumes/houghgrp/Processed Images/2019-2-6_9/results.mat');
disp('5')
a.results{6} = load('/Volumes/houghgrp/Processed Images/2019-2-6_11/results.mat');
a.results{7} = load('/Volumes/houghgrp/Processed Images/2019-2-6_13/results.mat');
disp('7')
a.results{8} = load('/Volumes/houghgrp/Processed Images/2019-2-6_15/results.mat');
a.results{9} = load('/Volumes/houghgrp/Processed Images/2019-2-6_17/results.mat');
disp('9')
a.results{10} = load('/Volumes/houghgrp/Processed Images/2019-2-6_19/results.mat');
a.results{11} = load('/Volumes/houghgrp/Processed Images/2019-2-6_21/results.mat');
disp('11')
a.results{12} = load('/Volumes/houghgrp/Processed Images/2019-2-6_23/results.mat');

%%
 b.results = cell(1,9);
b.results{1} = load('/Volumes/houghgrp/Processed Images/2019-2-12_1/results.mat');
disp('1')
b.results{2} = load('/Volumes/houghgrp/Processed Images/2019-2-12_3/results.mat');
b.results{3} = load('/Volumes/houghgrp/Processed Images/2019-2-12_5/results.mat');
disp('3')
b.results{4} = load('/Volumes/houghgrp/Processed Images/2019-2-12_7/results.mat');
b.results{5} = load('/Volumes/houghgrp/Processed Images/2019-2-12_9/results.mat');
disp('5')
b.results{6} = load('/Volumes/houghgrp/Processed Images/2019-2-12_17/results.mat');
b.results{7} = load('/Volumes/houghgrp/Processed Images/2019-2-12_11/results.mat');
disp('7')
b.results{8} = load('/Volumes/houghgrp/Processed Images/2019-2-12_13/results.mat');
b.results{9} = load('/Volumes/houghgrp/Processed Images/2019-2-12_15/results.mat');

 %%
%  results = cell(1,num);
%  results{1} = load('/Volumes/houghgrp/Processed Images/2019-1-3_1/results.mat');
% results{2} = load('/Volumes/houghgrp/Processed Images/2019-1-3_3/results.mat');
% results{3} = load('/Volumes/houghgrp/Processed Images/2019-1-3_6/results.mat');
% results{4} = load('/Volumes/houghgrp/Processed Images/2019-1-3_9/results.mat');
% results{5} = load('/Volumes/houghgrp/Processed Images/2019-1-3_11/results.mat');

 %%
 results = cell(1,12);
 results{1} = load('/Volumes/houghgrp/Processed Images/2019-2-15_1/results.mat');
results{2} = load('/Volumes/houghgrp/Processed Images/2019-2-15_3/results.mat');
results{3} = load('/Volumes/houghgrp/Processed Images/2019-2-15_5/results.mat');
results{4} = load('/Volumes/houghgrp/Processed Images/2019-2-15_7/results.mat');
results{5} = load('/Volumes/houghgrp/Processed Images/2019-2-15_9/results.mat');
 results{6} = load('/Volumes/houghgrp/Processed Images/2019-2-15_11/results.mat');
results{7} = load('/Volumes/houghgrp/Processed Images/2019-2-15_13/results.mat');
results{8} = load('/Volumes/houghgrp/Processed Images/2019-2-15_15/results.mat');
results{9} = load('/Volumes/houghgrp/Processed Images/2019-2-15_17/results.mat');
results{10} = load('/Volumes/houghgrp/Processed Images/2019-2-15_19/results.mat');
 results{11} = load('/Volumes/houghgrp/Processed Images/2019-2-15_21/results.mat');
results{12} = load('/Volumes/houghgrp/Processed Images/2019-2-15_23/results.mat');

 %%
 results = cell(1,12);
 results{1} = load('/Volumes/houghgrp/Processed Images/2019-2-19_1/results.mat');
results{2} = load('/Volumes/houghgrp/Processed Images/2019-2-19_3/results.mat');
results{3} = load('/Volumes/houghgrp/Processed Images/2019-2-19_5/results.mat');
results{4} = load('/Volumes/houghgrp/Processed Images/2019-2-19_7/results.mat');
results{5} = load('/Volumes/houghgrp/Processed Images/2019-2-19_9/results.mat');
 results{6} = load('/Volumes/houghgrp/Processed Images/2019-2-19_11/results.mat');
results{7} = load('/Volumes/houghgrp/Processed Images/2019-2-19_13/results.mat');
results{8} = load('/Volumes/houghgrp/Processed Images/2019-2-19_15/results.mat');
results{9} = load('/Volumes/houghgrp/Processed Images/2019-2-19_17/results.mat');
results{10} = load('/Volumes/houghgrp/Processed Images/2019-2-19_19/results.mat');
 results{11} = load('/Volumes/houghgrp/Processed Images/2019-2-19_21/results.mat');
results{12} = load('/Volumes/houghgrp/Processed Images/2019-2-19_23/results.mat');

%%
a = zeros(num,2);
c = zeros(num,2);
tau = zeros(num,2);
ci = cell(num,2);
%%
for n=1:num
    a(n,:) = results{n}.a2;
    c(n,:) = results{n}.c2;
    tau(n,:) = results{n}.tau2;
    %ci{n,:} = results{n}.ci;
end

%%
atest1 = zeros(num,2);
ctest1 = zeros(num,2);
tautest1 = zeros(num,2);
for n=1:num
    [fitresult, ~] = FRAPfit(results{n}.time(1:end/2), results{n}.norm2(1,1:end/2));
    atest1(n,1) = fitresult.a;
    ctest1(n,1) = fitresult.c;
    tautest1(n,1) = fitresult.tau;
    
    
    [fitresult, ~] = FRAPfit(results{n}.time(1:end/2), results{n}.norm2(2,1:end/2));
    atest1(n,2) = fitresult.a;
    ctest1(n,2) = fitresult.c;
    tautest1(n,2) = fitresult.tau;
end

%%
atest2 = zeros(10,2);
ctest2 = zeros(10,2);
tautest2 = zeros(10,2);
for n=1:10
    [fitresult, ~] = FRAPfit(results{n}.time(end/2:end), results{n}.norm2(1,end/2:end));
    atest2(n,1) = fitresult.a;
    ctest2(n,1) = fitresult.c;
    tautest2(n,1) = fitresult.tau;
    
    [fitresult, ~] = FRAPfit(results{n}.time(end/2:end), results{n}.norm2(2,end/2:end));
    atest2(n,2) = fitresult.a;
    ctest2(n,2) = fitresult.c;
    tautest2(n,2) = fitresult.tau;
end

%%
atest31 = zeros(10,2);
atest32 = zeros(10,2);
ctest3 = zeros(10,2);
tautest31 = zeros(10,2);
tautest32 = zeros(10,2);
for n=1:10
    [fitresult, ~] = FRAPfit2component(results{n}.time, results{n}.norm2(1,:));
    atest31(n,1) = fitresult.a1;
    ctest3(n,1) = fitresult.c;
    tautest31(n,1) = fitresult.tau1;
    
    atest32(n,1) = fitresult.a2;
    tautest32(n,1) = fitresult.tau2;
    
    [fitresult, ~] = FRAPfit2component(results{n}.time, results{n}.norm2(2,:));
    atest31(n,2) = fitresult.a1;
    ctest3(n,2) = fitresult.c;
    tautest31(n,2) = fitresult.tau1;
    
    atest32(n,2) = fitresult.a2;
    tautest32(n,2) = fitresult.tau2;
end

%% use this one
% atest4 = zeros(num,2);
% ctest4 = zeros(num,2);
% tautest4 = zeros(num,2);
for n=1:num

    try
    [fitresult, ~] = FRAPfitBessel(results{n}.time(2:end), results{n}.norm2(1,2:end));
    a(n,1) = fitresult.a;
    c(n,1) = fitresult.c;
    tau(n,1) = fitresult.tau;
    ci{n,1} = confint(fitresult);
    catch
        disp(['could not fit NTF2 ' num2str(n)]);
    end
    try
    [fitresult, ~] = FRAPfitBessel(results{n}.time(2:end), results{n}.norm2(2,(2:end)));
    a(n,2) = fitresult.a;
    c(n,2) = fitresult.c;
    tau(n,2) = fitresult.tau;
    ci{n,2} = confint(fitresult);
    catch
        disp(['could not fit mCherry ' num2str(n)]);
    end
end

%%
% atest4 = zeros(10,2);
% ctest4 = zeros(10,2);
% tautest4 = zeros(10,2);
for n=[8]
      [fitresult, ~] = FRAPfitBessel(results{n}.time, results{n}.norm2(2,:));
    %[fitresult, ~] = FRAPfit(results{n}.time, results{n}.norm2(1,:));
%     atest4(n,1) = fitresult.a;
%     ctest4(n,1) = fitresult.c;
%     tautest4(n,1) = fitresult.tau;
%     
     [fitresult, ~] = FRAPfitBessel(results{n}.time, results{n}.norm2(2,:));
%      [fitresult, ~] = FRAPfit(results{n}.time, results{n}.norm2(2,:));
%     atest4(n,2) = fitresult.a;
%     ctest4(n,2) = fitresult.c;
%     tautest4(n,2) = fitresult.tau;
end


%%
w = zeros(num,1);
D = zeros(num,2);
for n=1:num
    w(n) = (1.58)*sqrt(sum(sum(results{n}.bleachSpot))/pi);
    D(n,:) = w(n)^2./tau(n,:);
end

%%
plot(D,'o');

%%
for n=1:num
imshow(imadjust(im2double(results{n}.RedImages{1,1}),results{n}.redScale));
[~, ~, partRef, ~, ~] = roipoly(imadjust(im2double(results{n}.RedImages{1,1}),results{n}.redScale));
imshow(partRef);
results{n}.partRef = partRef;
close all
end
%%
for n=1:num
imshow(imadjust(im2double(results{n}.RedImages{1,1}),results{n}.redScale));
[~, ~, resRef, ~, ~] = roipoly(imadjust(im2double(results{n}.RedImages{1,1}),results{n}.redScale));
imshow(resRef);
results{n}.resRef = resRef;
close all
end
%%
for n=1:num
    totPart = sum(sum(imadjust(im2double(results{n}.GreenImages{1,1}),...
        results{n}.grnScale).*results{n}.partRef));
    totRes = sum(sum(imadjust(im2double(results{n}.GreenImages{1,1}),...
        results{n}.grnScale).*results{n}.resRef));
    areaPart = sum(sum(results{n}.partRef));
    areaRes = sum(sum(results{n}.resRef));
    partC(n,1) = (totPart/areaPart)/(totRes/areaRes);
    
    totPart = sum(sum(imadjust(im2double(results{n}.RedImages{1,1}),...
        results{n}.redScale).*results{n}.partRef));
    totRes = sum(sum(imadjust(im2double(results{n}.RedImages{1,1}),...
        results{n}.redScale).*results{n}.resRef));
    partC(n,2) = (totPart/areaPart)/(totRes/areaRes);
end
clear     totPart totRes areaPart areaRes

%%
bProb = zeros(num,1);

for n=1:num
    %bProb(n) = max(0,1-partCoeffs(n,2)/partCoeffs(ntau,1)); % expression from paper supplement
    bProb(n) = 1-partC(n,2)/partC(n,1); % expression from paper supplement
end
disp('Finished calculating partition coefficients and bound probability.');

%%
dBound = (D(:,1)-(1-bProb).*D(:,2))./bProb;
